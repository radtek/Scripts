
14:40:27 SQL>SET SERVEROUT ON SIZE UNL;
14:40:27 SQL>SET SQLBL ON;
14:40:27 SQL>PRO

14:40:27 SQL>SELECT USER FROM DUAL;

USER
------------------------------
SYSTEM

1 linha selecionada.

14:40:27 SQL>SELECT TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS') current_time FROM DUAL;

CURRENT_TIME
-------------------
2015-01-12 14:40:26

1 linha selecionada.

14:40:27 SQL>SELECT * FROM product_component_version;

PRODUCT
----------------------------------------------------------------------------------------------------
VERSION
----------------------------------------------------------------------------------------------------
STATUS
----------------------------------------------------------------------------------------------------
NLSRTL
11.2.0.3.0
Production

Oracle Database 11g Enterprise Edition
11.2.0.3.0
64bit Production

PL/SQL
11.2.0.3.0
Production

TNS for Linux:
11.2.0.3.0
Production


4 linhas selecionadas.

14:40:27 SQL>SELECT * FROM v$version;

BANNER
--------------------------------------------------------------------------------
Oracle Database 11g Enterprise Edition Release 11.2.0.3.0 - 64bit Production
PL/SQL Release 11.2.0.3.0 - Production
CORE	11.2.0.3.0	Production
TNS for Linux: Version 11.2.0.3.0 - Production
NLSRTL Version 11.2.0.3.0 - Production

5 linhas selecionadas.

14:40:27 SQL>SELECT * FROM v$instance;

INSTANCE_NUMBER INSTANCE_NAME    HOST_NAME                      VERSION
--------------- ---------------- ------------------------------ -----------------
STARTUP_TIME        STATUS       PAR    THREAD# ARCHIVE LOG_SWITCH_WAIT LOGINS     SHU
------------------- ------------ --- ---------- ------- --------------- ---------- ---
DATABASE_STATUS   INSTANCE_ROLE      ACTIVE_ST BLO
----------------- ------------------ --------- ---
              1 oratcc           oratcc01.ulbra                 11.2.0.3.0
12/01/2015 13:55:17 OPEN         NO           1 STOPPED                 ALLOWED    NO
ACTIVE            PRIMARY_INSTANCE   NORMAL    NO


1 linha selecionada.

14:40:27 SQL>SELECT name, value FROM v$parameter2 WHERE name LIKE '%dump_dest';

NAME
--------------------------------------------------------------------------------
VALUE
----------------------------------------------------------------------------------------------------
background_dump_dest
/u01/app/oracle/diag/rdbms/oratcc/oratcc/trace

user_dump_dest
/u01/app/oracle/diag/rdbms/oratcc/oratcc/trace

core_dump_dest
/u01/app/oracle/diag/rdbms/oratcc/oratcc/cdump


3 linhas selecionadas.

14:40:27 SQL>SELECT directory_name||' '||directory_path directories FROM sys.dba_directories WHERE directory_name LIKE 'SQLT$%' OR directory_name LIKE 'TRCA$%' ORDER BY 1;

DIRECTORIES
----------------------------------------------------------------------------------------------------
SQLT$BDUMP /u01/app/oracle/diag/rdbms/oratcc/oratcc/trace
SQLT$STAGE /u01/app/oracle/diag/rdbms/oratcc/oratcc/trace
SQLT$UDUMP /u01/app/oracle/diag/rdbms/oratcc/oratcc/trace
TRCA$INPUT1 /u01/app/oracle/diag/rdbms/oratcc/oratcc/trace
TRCA$INPUT2 /u01/app/oracle/diag/rdbms/oratcc/oratcc/trace
TRCA$STAGE /u01/app/oracle/diag/rdbms/oratcc/oratcc/trace

6 linhas selecionadas.

14:40:27 SQL>PRO

14:40:27 SQL>DEF _SQLPLUS_RELEASE
DEFINE _SQLPLUS_RELEASE = "1201000100" (CHAR)
14:40:27 SQL>PRO

14:40:27 SQL>SHO parameters NLS

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
nls_calendar                         string      GREGORIAN
nls_comp                             string      BINARY
nls_currency                         string      R$
nls_date_format                      string      dd/mm/rrrr hh24:mi:ss
nls_date_language                    string      BRAZILIAN PORTUGUESE
nls_dual_currency                    string      Cr$
nls_iso_currency                     string      BRAZIL
nls_language                         string      BRAZILIAN PORTUGUESE
nls_length_semantics                 string      BYTE
nls_nchar_conv_excp                  string      FALSE
nls_numeric_characters               string      ,.
nls_sort                             string      BINARY
nls_territory                        string      BRAZIL
nls_time_format                      string      HH24:MI:SSXFF
nls_time_tz_format                   string      HH24:MI:SSXFF TZR
nls_timestamp_format                 string      DD/MM/RR HH24:MI:SSXFF
nls_timestamp_tz_format              string      DD/MM/RR HH24:MI:SSXFF TZR
14:40:27 SQL>SHO parameters OPTIMIZER

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
optimizer_capture_sql_plan_baselines boolean     FALSE
optimizer_dynamic_sampling           integer     2
optimizer_features_enable            string      11.2.0.3
optimizer_index_caching              integer     0
optimizer_index_cost_adj             integer     100
optimizer_mode                       string      ALL_ROWS
optimizer_secure_view_merging        boolean     TRUE
optimizer_use_invisible_indexes      boolean     FALSE
optimizer_use_pending_statistics     boolean     FALSE
optimizer_use_sql_plan_baselines     boolean     TRUE
14:40:27 SQL>SHO parameters DUMP_DEST

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
background_dump_dest                 string      /u01/app/oracle/diag/rdbms/ora
                                                 tcc/oratcc/trace
core_dump_dest                       string      /u01/app/oracle/diag/rdbms/ora
                                                 tcc/oratcc/cdump
user_dump_dest                       string      /u01/app/oracle/diag/rdbms/ora
                                                 tcc/oratcc/trace
14:40:27 SQL>PRO

14:40:27 SQL>DEF tool_repository_schema = 'SQLTXPLAIN';
14:40:27 SQL>DEF tool_administer_schema = 'SQLTXADMIN';
14:40:27 SQL>DEF tool_version		= '12.1.11';
14:40:27 SQL>DEF role_name		= 'SQLT_USER_ROLE';
14:40:27 SQL>DEF temporary_or_permanent = 'T';
14:40:27 SQL>DEF
DEFINE _DATE           = "12/01/2015 14:40:27" (CHAR)
DEFINE _CONNECT_IDENTIFIER = "oratcc" (CHAR)
DEFINE _USER           = "SYSTEM" (CHAR)
DEFINE _PRIVILEGE      = "" (CHAR)
DEFINE _SQLPLUS_RELEASE = "1201000100" (CHAR)
DEFINE _EDITOR         = "Notepad" (CHAR)
DEFINE _O_VERSION      = "Oracle Database 11g Enterprise Edition Release 11.2.0.3.0 - 64bit Production
With the Partitioning, OLAP, Data Mining and Real Application Testing options" (CHAR)
DEFINE _O_RELEASE      = "1102000300" (CHAR)
DEFINE _RC             = "0" (CHAR)
DEFINE 1               = "g4pkmrqrgxg3b" (CHAR)
DEFINE TOOL_REPOSITORY_SCHEMA = "SQLTXPLAIN" (CHAR)
DEFINE TOOL_ADMINISTER_SCHEMA = "SQLTXADMIN" (CHAR)
DEFINE TOOL_VERSION    = "12.1.11" (CHAR)
DEFINE ROLE_NAME       = "SQLT_USER_ROLE" (CHAR)
DEFINE TEMPORARY_OR_PERMANENT = "T" (CHAR)
14:40:27 SQL>-- end common
14:40:27 SQL>14:40:27 SQL>REM $Header: 215187.1 sqltxtract.sql 12.1.07 2014/03/15 carlos.sierra mauro.pagano $
14:40:27 SQL>REM
14:40:27 SQL>REM Copyright (c) 2000-2013, Oracle Corporation. All rights reserved.
14:40:27 SQL>REM
14:40:27 SQL>REM AUTHOR
14:40:27 SQL>REM   carlos.sierra@oracle.com
14:40:27 SQL>REM   mauro.pagano@oracle.com
14:40:27 SQL>REM
14:40:27 SQL>REM SCRIPT
14:40:27 SQL>REM   sqlt/run/sqltxtract.sql
14:40:27 SQL>REM
14:40:27 SQL>REM DESCRIPTION
14:40:27 SQL>REM   Collects SQL tuning diagnostics data and generates a set of
14:40:27 SQL>REM   diagnostics files. It inputs one SQL_ID or HASH_VALUE of a
14:40:27 SQL>REM   known SQL that is memory resident or pre-captured by AWR.
14:40:27 SQL>REM
14:40:27 SQL>REM PRE-REQUISITES
14:40:27 SQL>REM   1. Use a dedicated SQL*Plus connection (not a shared one).
14:40:27 SQL>REM   2. User has been granted SQLT_USER_ROLE.
14:40:27 SQL>REM
14:40:27 SQL>REM PARAMETERS
14:40:27 SQL>REM   1. SQL_ID or HASH_VALUE of the SQL to be extracted (required)
14:40:27 SQL>REM   2. SQLTXPLAIN password (required).
14:40:27 SQL>REM
14:40:27 SQL>REM EXECUTION
14:40:27 SQL>REM   1. Navigate to sqlt main directory.
14:40:27 SQL>REM   2. Start SQL*Plus connecting as the application user of the SQL.
14:40:27 SQL>REM   3. Execute script sqltxtract.sql passing SQL_ID or HASH_VALUE
14:40:27 SQL>REM      of the one SQL. This SQL must be memory resident or
14:40:27 SQL>REM      pre-captured by AWR.
14:40:27 SQL>REM   4. Enter SQLTXPLAIN password when asked for it.
14:40:27 SQL>REM
14:40:27 SQL>REM EXAMPLE
14:40:27 SQL>REM   # cd sqlt
14:40:27 SQL>REM   # sqlplus apps
14:40:27 SQL>REM   SQL> START [path]sqltxtract.sql [SQL_ID]|[HASH_VALUE]
14:40:27 SQL>REM   SQL> START run/sqltxtract.sql 0w6uydn50g8cx
14:40:27 SQL>REM   SQL> START run/sqltxtract.sql 2524255098
14:40:27 SQL>REM
14:40:27 SQL>REM NOTES
14:40:27 SQL>REM   1. For possible errors see sqltxtract.log.
14:40:27 SQL>REM   2. For better output execute this script connected as the
14:40:27 SQL>REM      application user who issued the SQL.
14:40:27 SQL>REM
14:40:27 SQL>@@sqltcommon2.sql
14:40:27 SQL>REM $Header: 215187.1 sqltcommon2.sql 11.4.5.4 2013/02/04 carlos.sierra $
14:40:27 SQL>-- begin common
14:40:27 SQL>WHENEVER SQLERROR CONTINUE;
14:40:27 SQL>SELECT * FROM session_roles;

ROLE
------------------------------
DBA
SELECT_CATALOG_ROLE
HS_ADMIN_SELECT_ROLE
EXECUTE_CATALOG_ROLE
HS_ADMIN_EXECUTE_ROLE
DELETE_CATALOG_ROLE
EXP_FULL_DATABASE
IMP_FULL_DATABASE
DATAPUMP_EXP_FULL_DATABASE
DATAPUMP_IMP_FULL_DATABASE
GATHER_SYSTEM_STATISTICS
SCHEDULER_ADMIN
WM_ADMIN_ROLE
AQ_ADMINISTRATOR_ROLE
MGMT_USER

15 linhas selecionadas.

14:40:27 SQL>COL set_role_name NEW_V set_role_name;
14:40:27 SQL>SELECT NULL set_role_name FROM DUAL;

S
-


1 linha selecionada.

14:40:27 SQL>SELECT role set_role_name FROM session_roles WHERE role = '^^role_name.';

não há linhas selecionadas

14:40:27 SQL>SELECT DECODE('^^set_role_name.', NULL, '^^role_name.', NULL) set_role_name FROM DUAL;

SET_ROLE_NAME
--------------
SQLT_USER_ROLE

1 linha selecionada.

14:40:27 SQL>SET ROLE ^^set_role_name.;

Conjunto de funções.

14:40:27 SQL>SELECT * FROM session_roles;

ROLE
------------------------------
SQLT_USER_ROLE
SELECT_CATALOG_ROLE
HS_ADMIN_SELECT_ROLE

3 linhas selecionadas.

14:40:27 SQL>COL libraries FOR A64;
14:40:27 SQL>SELECT SUBSTR(text, INSTR(text, ' ', 1, 3) + 1,  INSTR(text, ' ', 1, 6) - INSTR(text, ' ', 1, 3)) libraries
14:40:27   2  	FROM all_source
14:40:27   3   WHERE owner = '^^tool_administer_schema.'
14:40:27   4  	 AND line = 2
14:40:27   5  	 AND text LIKE '%$Header%'
14:40:27   6   ORDER BY 1;

LIBRARIES
----------------------------------------------------------------
sqcpkga.pks 12.1.10 2014/08/08
sqcpkgc.pks 12.1.10 2014/08/08
sqcpkgd.pks 12.1.11 2014/30/10
sqcpkge.pks 12.1.10 2014/08/08
sqcpkgh.pks 12.1.10 2014/08/08
sqcpkgi.pks 12.1.10 2014/08/08
sqcpkgm.pks 12.1.10 2014/08/08
sqcpkgr.pks 12.1.10 2014/08/08
sqcpkgs.pks 12.1.10 2014/08/08
sqcpkgt.pks 12.1.10 2014/08/08
tacpkge.pks 11.4.5.0 2012/11/21
tacpkgg.pks 11.4.5.0 2012/11/21
tacpkgi.pks 11.4.5.0 2012/11/21
tacpkgp.pks 11.4.5.0 2012/11/21
tacpkgr.pks 11.4.5.0 2012/11/21
tacpkgt.pks 11.4.5.0 2012/11/21
tacpkgx.pks 11.4.5.0 2012/11/21

17 linhas selecionadas.

14:40:27 SQL>PRO

14:40:27 SQL>SELECT status||' '||object_type||' '||object_name libraries
14:40:27   2  	FROM all_objects
14:40:27   3   WHERE owner = '^^tool_administer_schema.'
14:40:27   4  	 AND object_type LIKE 'PACKAGE%'
14:40:27   5   ORDER BY 1;

LIBRARIES
----------------------------------------------------------------
VALID PACKAGE SQLT$A
VALID PACKAGE SQLT$C
VALID PACKAGE SQLT$D
VALID PACKAGE SQLT$E
VALID PACKAGE SQLT$H
VALID PACKAGE SQLT$I
VALID PACKAGE SQLT$M
VALID PACKAGE SQLT$R
VALID PACKAGE SQLT$S
VALID PACKAGE SQLT$T
VALID PACKAGE TRCA$E
VALID PACKAGE TRCA$G
VALID PACKAGE TRCA$I
VALID PACKAGE TRCA$P
VALID PACKAGE TRCA$R
VALID PACKAGE TRCA$T
VALID PACKAGE TRCA$X

17 linhas selecionadas.

14:40:28 SQL>PRO

14:40:28 SQL>COL lib_count NEW_V lib_count FOR 999;
14:40:28 SQL>COL role_count NEW_V role_count FOR 999;
14:40:28 SQL>PRO

14:40:28 SQL>SELECT COUNT(*) lib_count FROM all_objects WHERE owner = '^^tool_administer_schema.' AND object_type = 'PACKAGE' AND status = 'VALID';

LIB_COUNT
---------
       17

1 linha selecionada.

14:40:28 SQL>SELECT COUNT(*) role_count FROM user_role_privs WHERE granted_role IN ('^^role_name.', 'DBA');

ROLE_COUNT
----------
         2

1 linha selecionada.

14:40:28 SQL>SELECT granted_role FROM user_role_privs WHERE granted_role IN ('^^role_name.', 'DBA');

GRANTED_ROLE
------------------------------
DBA
SQLT_USER_ROLE

2 linhas selecionadas.

14:40:28 SQL>SELECT user FROM dual;

USER
------------------------------
SYSTEM

1 linha selecionada.

14:40:28 SQL>PRO

14:40:28 SQL>SET TERM ON ECHO OFF;


Procedimento PL/SQL concluído com sucesso.



Parameter 1:
SQL_ID or HASH_VALUE of the SQL to be extracted (required)



SQL_ID_OR_HAS
-------------
g4pkmrqrgxg3b

1 linha selecionada.


Paremeter 2:
SQLTXPLAIN password (required)

Informe o valor para 2: oracle

Procedimento PL/SQL concluído com sucesso.


DECLARE
*
ERRO na linha 1:
ORA-20106: SQLT parameter connect_identifier must be set when running SQLT from a remote client
ORA-06512: em line 10


